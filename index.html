<!-- Menggunakan AI VSCode-->
<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Muhammad Malik F — Portfolio</title>

  <!--
    Style ter-embed: tema hitam-putih kontras tinggi, responsif.
    Komentar di setiap bagian penting (Bahasa Indonesia).
  -->
  <style>
    :root{
      --bg:#000;
      --fg:#fff;
      --muted:#bfbfbf;
      --accent:#fff; /* tombol warna-warni diubah inline agar kontras */
      --glass: rgba(255,255,255,0.04);
      --card:#0b0b0b;
      --nav-height:64px; /* tinggi navbar yang konsisten */
      --focus: 3px solid #fff;
      --transition: 300ms ease;
    }

    /* Reset dasar */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--fg);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.4;
    }

    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    button, input, textarea{font:inherit;color:inherit}

    /* Fokus keyboard terlihat tinggi kontras */
    :focus{outline:var(--focus);outline-offset:2px}

    /* LOADING SCREEN (full) */
    .loading {
      position:fixed;inset:0;
      display:flex;flex-direction:column;
      align-items:center;justify-content:center;
      background:linear-gradient(180deg,#111 0%, #000 60%);
      z-index:9999;
      transition:opacity 600ms ease, transform 600ms ease;
    }

    .loading.hidden{opacity:0;pointer-events:none;transform:translateY(-12px)}

    .loading-inner{width:min(900px,92%);max-width:1100px;padding:24px;text-align:center}
    .loading-title{font-weight:700;font-size:1.25rem;margin-bottom:12px}
    .spinner {
      width:48px;height:48px;border-radius:50%;
      border:4px solid rgba(255,255,255,0.08);
      border-top-color:var(--fg);
      animation:spin 1s linear infinite;margin:12px auto;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    .progress {
      width:100%;height:12px;background:rgba(255,255,255,0.06);
      border-radius:999px;overflow:hidden;margin-top:14px;
      box-shadow:inset 0 -2px 8px rgba(0,0,0,0.6);
    }
    .progress > .bar {
      height:100%;width:0%;background:linear-gradient(90deg,#fff,#cfcfcf);
      transition:width 200ms linear;
    }
    .loading-sub {font-size:0.9rem;color:var(--muted);margin-top:8px}

    /* NAVBAR */
    header.site-header{
      position:fixed;
      top:0;left:0;right:0;
      height:var(--nav-height);
      z-index:1000;
      backdrop-filter: blur(6px);
    }
    .nav {
      display:flex;align-items:center;justify-content:space-between;
      max-width:1200px;margin:0 auto;height:100%;
      padding:0 18px;
      transition: background-color 300ms ease, box-shadow 300ms ease, transform 300ms ease;
    }
    .nav.transparent{background:transparent}
    .nav.solid{
      background: linear-gradient(90deg, rgba(255,138,0,0.95), rgba(229,46,113,0.95));
      box-shadow:0 6px 30px rgba(0,0,0,0.6);
      color:var(--fg);
    }
    .brand {display:flex;align-items:center;gap:12px}
    .brand img{width:44px;height:44px;border-radius:6px;object-fit:cover}
    .brand .name{font-weight:700;font-size:1.05rem}
    nav .menu {display:flex;gap:18px;align-items:center}
    .menu a{padding:6px 8px;border-radius:6px;color:var(--fg);font-weight:600}
    .menu a:hover{background:var(--glass)}
    .other-btn{
      padding:8px 12px;border-radius:999px;border:none;cursor:pointer;
      color:#000;font-weight:700;background:linear-gradient(90deg,#ffd66b,#ff7a7a,#6bd3ff);
      box-shadow:0 6px 18px rgba(0,0,0,0.4);
    }
    /* MOBILE MENU */
    .menu-mobile-btn {
      display:none;
      background:transparent;
      border:none;
      color:var(--fg);
      font-size:1rem;
      cursor:pointer;
      margin-left:12px;
      padding:0;
    }
    /* boxed hamburger icon */
    .menu-mobile-btn .hamburger{display:inline-flex;flex-direction:column;gap:5px;align-items:center;justify-content:center;width:44px;height:44px;border-radius:8px;background:rgba(255,255,255,0.06);padding:8px}
    .menu-mobile-btn .hamburger span{display:block;width:20px;height:2px;background:var(--fg);border-radius:2px}
    .menu-mobile {
      display:none;
      position:fixed;
      top:var(--nav-height);
      left:0;right:0;
      background:linear-gradient(180deg,rgba(0,0,0,0.98),rgba(0,0,0,0.96));
      z-index:1200;
      flex-direction:column;
      gap:18px;
      padding:24px 18px;
      box-shadow:0 8px 24px rgba(0,0,0,0.5);
      animation:fadeInMenu 0.3s;
    }
    @keyframes fadeInMenu {from{opacity:0;transform:translateY(-20px);}to{opacity:1;transform:none;}}
    .menu-mobile.open {display:flex;}
    .menu-mobile a, .menu-mobile button {
      padding:12px 0;
      font-size:1.1rem;
      border:none;
      background:none;
      color:var(--fg);
      text-align:left;
      width:100%;
      border-radius:8px;
    }
    .menu-mobile a:hover, .menu-mobile button:hover {background:var(--glass);}
  @media (max-width:900px){
      .menu {display:none;}
      .menu-mobile-btn {display:inline-block;}
    }
    /* padding main agar tidak tertutup navbar */
    main{max-width:1200px;margin:28px auto;padding:calc(var(--nav-height) + 28px) 18px 28px}

    /* INTRO SECTION */
    .intro{display:flex;gap:28px;align-items:center;justify-content:space-between;margin-top:12px}
    .intro .left{flex:1;min-width:260px}
    .intro h1{font-size:1.6rem;margin-bottom:6px}
    .intro p{color:var(--muted);margin:8px 0}
    .meta-list{list-style:none;padding:0;margin:8px 0 18px 0;color:var(--muted)}
    .meta-list li{margin-bottom:6px}
    .btn-cv{display:inline-block;padding:10px 14px;border-radius:8px;background:var(--fg);color:var(--bg);font-weight:700;border:none;cursor:pointer}

    /* Profil (kanan) dengan efek zoom + flip on click */
    .profile-wrap{width:220px;height:220px;perspective:1200px}
    .profile{
      width:100%;height:100%;border-radius:999px;position:relative;transform-style:preserve-3d;
      transition:transform 700ms var(--transition);
      cursor:pointer;
      box-shadow:0 8px 30px rgba(0,0,0,0.6);
    }
    .profile:hover{transform:scale(1.03) rotateY(0deg)}
    .profile.is-flipped{transform:rotateY(180deg)}
    .profile .face{
      position:absolute;inset:0;border-radius:999px;backface-visibility:hidden;overflow:hidden;
      display:flex;align-items:center;justify-content:center;background:var(--card)
    }
    .profile .face img{width:100%;height:100%;object-fit:cover}
    .profile .back{transform:rotateY(180deg);}

    /* SECTIONS: Projects & Current Projects */
    .section{margin-top:46px}
    .section h2{font-size:1.25rem;margin-bottom:12px}
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    .filter-btn, .page-btn{padding:8px 10px;border-radius:8px;border:none;background:var(--glass);cursor:pointer;font-weight:600}
    .filter-btn.active{box-shadow:inset 0 -2px 6px rgba(0,0,0,0.6);background:#fff;color:#000}

    .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .card{
      background:linear-gradient(180deg,#0a0a0a,#070707);padding:10px;border-radius:10px;overflow:hidden;
      display:flex;flex-direction:column;gap:8px;transform:translateY(20px);opacity:0;transition:transform 420ms ease,opacity 420ms ease;
    }
    .card.visible{transform:translateY(0);opacity:1}
    .card img{width:100%;height:140px;object-fit:cover;border-radius:8px}
    .card .title{font-weight:700}
    .card .desc{color:var(--muted);font-size:0.92rem}
    /* .card .actions{margin-top:auto;display:flex;gap:8px;align-items:center} */
    /* tombol hapus dihapus */

    /* COMMENTS SECTION (juga modal) */
    .comments-section{margin-top:48px;padding:18px;background:linear-gradient(180deg,transparent,rgba(255,255,255,0.02));border-radius:12px}
    .comment-form{display:flex;flex-direction:column;gap:8px;max-width:720px}
    .comment-form input, .comment-form textarea{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px;border-radius:8px;color:var(--fg)}
    .comment-form button{width:max-content;padding:10px 12px;border-radius:8px;border:none;background:var(--fg);color:var(--bg);font-weight:700;cursor:pointer}
    .comments-list{margin-top:14px;display:flex;flex-direction:column;gap:10px}
    .comment-item{background:var(--card);padding:12px;border-radius:10px;display:flex;justify-content:space-between;gap:12px;align-items:flex-start}
    .comment-meta{font-weight:700;margin-bottom:6px}
    .comment-date{color:var(--muted);font-size:0.85rem}
    .comment-delete{background:#ff4d4d;border:none;color:#fff;padding:6px;border-radius:8px;cursor:pointer}

    /* Comments modal (full-screen) */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);z-index:2500;padding:20px}
    .modal.open{display:flex}
  .modal .panel{background:#070707;border-radius:12px;padding:18px;max-width:900px;width:100%;max-height:90vh;overflow:auto}

  /* OVERLAY: My Other Website (dialog) */
  .overlay-sites{display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);z-index:2400;padding:24px}
  .overlay-sites.open{display:flex}
  .overlay-sites .sites-grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));max-width:1100px;width:100%}
  .site-card{background:linear-gradient(180deg,#0b0b0b,#070707);padding:10px;border-radius:10px;color:var(--fg);display:flex;gap:12px;align-items:flex-start;text-decoration:none}
  .site-card img{width:160px;height:100px;object-fit:cover;border-radius:8px;flex-shrink:0}
  .overlay-close{position:absolute;top:18px;right:18px;background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--fg);padding:8px 10px;border-radius:8px;cursor:pointer}

    /* Responsive kecil */
  @media (max-width:900px){
      .intro{flex-direction:column;align-items:center}
      .profile-wrap{width:180px;height:180px}
      .brand .name{display:none}
      /* .menu{display:none} sudah diatur di atas */
    }
  </style>
</head>
<body>
  <!-- LOADING SCREEN -->
  <div class="loading" id="loading" role="status" aria-live="polite" aria-labelledby="load-title">
    <div class="loading-inner" role="document">
      <div id="load-title" class="loading-title">Muhammad Malik F ~ Memuat portofolio</div>
      <div class="spinner" aria-hidden="true"></div>
      <div class="progress" aria-hidden="true" aria-label="Progress memuat">
        <div class="bar" id="progress-bar" style="width:0%"></div>
      </div>
      <div class="loading-sub">Halaman sedang dimuat. Mohon tunggu...</div>
    </div>
  </div>

  <!-- OVERLAY untuk My Other Website -->
  <div class="overlay-sites" id="overlaySites" aria-hidden="true" role="dialog" aria-label="My other websites">
    <button class="overlay-close" id="closeSites" aria-label="Tutup daftar situs">Tutup ✕</button>
    <div class="sites-grid" role="list">
      <!-- contoh kartu; bisa ditambah -->
      <a class="site-card" role="listitem" href="https://example.com" target="_blank" rel="noopener">
        <img src="https://placehold.co/200x140?text=Situs+1" alt="Situs 1">
        <div class="meta">
          <div style="font-weight:700">Situs Lain 1</div>
          <div style="color:var(--muted);font-size:0.9rem">Deskripsi singkat</div>
        </div>
      </a>
      <a class="site-card" role="listitem" href="https://example.com" target="_blank" rel="noopener">
        <img src="https://placehold.co/200x140?text=Situs+2" alt="Situs 2">
        <div class="meta">
          <div style="font-weight:700">Situs Lain 2</div>
          <div style="color:var(--muted);font-size:0.9rem">Deskripsi singkat</div>
        </div>
      </a>
      <a class="site-card" role="listitem" href="https://example.com" target="_blank" rel="noopener">
        <img src="https://placehold.co/200x140?text=Situs+3" alt="Situs 3">
        <div class="meta">
          <div style="font-weight:700">Situs Lain 3</div>
          <div style="color:var(--muted);font-size:0.9rem">Deskripsi singkat</div>
        </div>
      </a>
    </div>
  </div>

  <!-- HEADER / NAVBAR -->
  <header class="site-header" role="banner">
    <div class="nav transparent" id="siteNav">
      <div class="brand" aria-hidden="false">
        <img src="https://placehold.co/120x80?text=Logo" alt="Logo Sekolah (placeholder)">
        <div class="name">Muhammad Malik F</div>
      </div>
      <nav role="navigation" aria-label="Main menu">
        <div class="menu" id="menuItems">
          <a href="#home" class="menu-link">Home</a>
          <a href="#portfolio" class="menu-link">Portofolio</a>
          <a href="#myprojects" class="menu-link">My Projek</a>
          <a href="#current" class="menu-link">Projek yang sedang di kerjakan</a>
          <a href="#contact" class="menu-link">Contact</a>
          <a href="#comments" class="menu-link" id="openCommentsBtn">Comments</a>
          <button class="other-btn" id="openSitesBtn" aria-haspopup="dialog" aria-expanded="false">My Other Website</button>
        </div>
        <!-- Tombol hamburger untuk mobile -->
        <button class="menu-mobile-btn" id="menuMobileBtn" aria-label="Buka menu">&#9776;</button>
      </nav>
    </div>
    <!-- Menu mobile, muncul saat tombol hamburger ditekan -->
    <nav class="menu-mobile" id="menuMobile">
      <a href="#home" class="menu-link">Home</a>
      <a href="#portfolio" class="menu-link">Portofolio</a>
      <a href="#myprojects" class="menu-link">My Projek</a>
      <a href="#current" class="menu-link">Projek yang sedang di kerjakan</a>
      <a href="#contact" class="menu-link">Contact</a>
      <a href="#comments" class="menu-link" id="openCommentsBtnMobile">Comments</a>
      <button class="other-btn" id="openSitesBtnMobile" aria-haspopup="dialog" aria-expanded="false">My Other Website</button>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <main id="main" role="main">
    <!-- INTRO SECTION -->
    <section id="home" class="intro" aria-labelledby="introTitle">
      <div class="left">
        <h1 id="introTitle">Muhammad Malik F</h1>
        <p style="color:var(--muted)">Software & Game Developer — SMK Informatika Fithrah Insani</p>
        <ul class="meta-list" aria-hidden="false">
          <li><strong>Sekolah:</strong> SMK Informatika Fithrah Insani</li>
          <li><strong>Kelas:</strong> 11 SMK jurusan PPLG</li>
        </ul>
        <p style="max-width:640px;color:var(--muted)">
          Saya fokus pada pengembangan perangkat lunak dan game, menggabungkan logika pemrograman dan desain kreatif. 
          Lihat proyek dan komentar di halaman ini.
        </p>
      <!--  <p style="margin-top:12px">
          <a class="btn-cv" href="#" role="button" aria-label="Download CV (placeholder)">Download CV</a>
        </p> -->
      </div>

      <div class="profile-wrap" aria-hidden="false">
        <!-- Profil bundar: dua sisi (front/back) untuk flip -->
        <div class="profile" id="profileCard" tabindex="0" role="button" aria-pressed="false" aria-label="Foto profil. Tekan untuk membalik.">
          <div class="face front">
            <img src="img/meme1.jpeg" alt="Foto depan Muhammad Malik">
          </div>
          <div class="face back">
            <img src="img/index.jpeg" alt="Foto belakang Muhammad Malik">
          </div>
        </div>
      </div>
    </section>

    <!-- PORTFOLIO SECTION (ringkasan) -->
    <section id="portfolio" class="section" aria-labelledby="portfolioTitle">
      <h2 id="portfolioTitle">Portofolio</h2>
      <p style="color:var(--muted)">Contoh proyek yang relevan dengan jurusan PPLG dan pengembangan aplikasi.</p>
    </section>

    <!-- MY PROJECTS (12 items) -->
    <section id="myprojects" class="section" aria-labelledby="projectsTitle">
      <h2 id="projectsTitle">My Projek</h2>
      <div class="controls" aria-hidden="false">
        <div>
          <button class="filter-btn active" data-filter="all">Semua</button>
          <button class="filter-btn" data-filter="web">Web</button>
          <button class="filter-btn" data-filter="mobile">Mobile</button>
          <button class="filter-btn" data-filter="game">Game</button>
          <button class="filter-btn" data-filter="ai">AI</button>
        </div>
        <div style="margin-left:auto;display:flex;gap:8px">
          <button class="page-btn" id="prevProjects">Prev</button>
          <button class="page-btn" id="nextProjects">Next</button>
        </div>
      </div>
      <div class="grid" id="projectsGrid" aria-live="polite" aria-label="Daftar projek">
        <!-- Dihasilkan oleh JS -->
      </div>
      <div style="margin-top:12px">
        <button class="filter-btn" id="loadMoreProjects">Load more</button>
      </div>
    </section>

    <!-- CURRENT PROJECTS (12 items) -->
    <section id="current" class="section" aria-labelledby="currentTitle">
      <h2 id="currentTitle">Projek yang sedang di kerjakan</h2>

      <div class="controls">
        <div>
          <button class="filter-btn active" data-filter="all">Semua</button>
          <button class="filter-btn" data-filter="web">Web</button>
          <button class="filter-btn" data-filter="mobile">Mobile</button>
          <button class="filter-btn" data-filter="game">Game</button>
        </div>
        <div style="margin-left:auto;display:flex;gap:8px">
          <button class="page-btn" id="prevCurrent">Prev</button>
          <button class="page-btn" id="nextCurrent">Next</button>
        </div>
      </div>

      <div class="grid" id="currentGrid" aria-live="polite" aria-label="Daftar projek sedang dikerjakan">
        <!-- Dihasilkan oleh JS -->
      </div>
      <div style="margin-top:12px">
        <button class="filter-btn" id="loadMoreCurrent">Load more</button>
      </div>
    </section>

    <!-- COMMENTS SECTION (inline) -->
    <section id="comments" class="comments-section" aria-labelledby="commentsTitle">
      <h2 id="commentsTitle">Comments</h2>
      <form id="commentForm" class="comment-form" aria-label="Form komentar">
        <label for="cname">Nama</label>
        <input id="cname" name="name" type="text" placeholder="Nama (opsional)">
        <label for="cmsg">Pesan</label>
        <textarea id="cmsg" name="message" rows="4" required placeholder="Tulis komentar..."></textarea>
        <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
          <button type="submit">Post Comment</button>
          <button type="button" id="openCommentsModal">Buka Halaman Komentar</button>
          <button type="button" id="showDeletedBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px">Tampilkan yang dihapus</button>
        </div>
      </form>

      <div class="comments-list" id="commentsList" aria-live="polite" aria-label="Daftar komentar">
        <!-- Komentar akan dirender di sini -->
      </div>
    </section>

    <!-- CONTACT (placeholder) -->
    <section id="contact" class="section" aria-labelledby="contactTitle">
      <h2 id="contactTitle">Contact</h2>
      <p style="color:var(--muted)">Hubungi via WhatsApp atau email (placeholder).</p>
    </section>
  </main>

  <!-- COMMENTS MODAL (full) -->
  <div class="modal" id="commentsModal" role="dialog" aria-hidden="true" aria-label="Halaman komentar">
    <div class="panel" role="document">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3 style="margin:0">Halaman Komentar</h3>
        <div>
          <button id="closeCommentsModal" style="margin-right:8px">Tutup</button>
        </div>
      </div>

      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px">
        <button id="filters-all" class="filter-btn active">Semua</button>
        <button id="filters-active" class="filter-btn">Aktif</button>
        <button id="filters-deleted" class="filter-btn">Terhapus</button>
      </div>

      <div id="modalCommentsArea">
        <!-- konten comments modal di-generate JS -->
      </div>
    </div>
  </div>

  <!-- SCRIPTS: semua logic vanilla JS -->
  <script>
    /*************************************************************************
     * Utilities kecil
     *************************************************************************/
    // escape sederhana untuk mencegah injection HTML
    function esc(s){
      return String(s || '').replace(/[&<>"']/g, function(m){
        return ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' })[m];
      });
    }

    // short helper untuk buat elemen dengan class
    function el(tag, cls){ const e=document.createElement(tag); if(cls) e.className=cls; return e; }

    /*************************************************************************
     * LOADING: animasi progress + spinner; durasi antara 2500ms - 4000ms
     *************************************************************************/
    (function(){
      const loading = document.getElementById('loading');
      const bar = document.getElementById('progress-bar');
      let duration = 3000 + (Math.random()*1000-250); // ~2.75-3.75s
      duration = Math.max(2500, Math.min(4000, duration));

      // animasi progress halus menggunakan requestAnimationFrame
      let start = null;
      function step(ts){
        if(!start) start = ts;
        let elapsed = ts - start;
        let pct = Math.min(1, elapsed / duration);
        // gunakan easing (easeOutCubic)
        let eased = 1 - Math.pow(1 - pct, 3);
        bar.style.width = (eased*100).toFixed(2) + '%';
        if(pct < 1) requestAnimationFrame(step);
        else finishLoading();
      }
      requestAnimationFrame(step);

      function finishLoading(){
        // tambahkan delay kecil untuk UX
        setTimeout(()=>{
          loading.classList.add('hidden');
          // beri fokus ke main agar pembaca screen langsung ke konten
          const main = document.getElementById('main');
          main.setAttribute('tabindex','-1');
          main.focus();
        }, 420);
      }
    })();

    /*************************************************************************
     * NAVBAR: transparan -> solid saat scroll
     *************************************************************************/
    (function(){
      const nav = document.getElementById('siteNav');
      const threshold = 24;
      function onScroll(){
        if(window.scrollY > threshold) { nav.classList.remove('transparent'); nav.classList.add('solid'); }
        else { nav.classList.remove('solid'); nav.classList.add('transparent'); }
      }
      document.addEventListener('scroll', onScroll, {passive:true});
      onScroll();
    })();

    /*************************************************************************
     * Overlay My Other Website
     *************************************************************************/
    (function(){
      const btn = document.getElementById('openSitesBtn');
      const btnMobile = document.getElementById('openSitesBtnMobile');
      const overlay = document.getElementById('overlaySites');
      const close = document.getElementById('closeSites');
      // safe guards
      if(!overlay) return;

      // track the element that opened the overlay so we can restore focus
      let opener = null;

      function open(e){
        opener = e ? e.currentTarget : opener;
        overlay.classList.add('open');
        overlay.setAttribute('aria-hidden','false');
        if(opener && opener.setAttribute) opener.setAttribute('aria-expanded','true');
        // move focus to first focusable inside overlay (close button)
        const first = overlay.querySelector('button, a');
        if(first) first.focus();
      }

      function closeOverlay(){
        overlay.classList.remove('open');
        overlay.setAttribute('aria-hidden','true');
        if(opener && opener.setAttribute) opener.setAttribute('aria-expanded','false');
        if(opener && opener.focus) opener.focus();
      }

      if(btn) btn.addEventListener('click', open);
      if(btnMobile) btnMobile.addEventListener('click', open);
      if(close) close.addEventListener('click', closeOverlay);
      overlay.addEventListener('click', (e)=>{ if(e.target===overlay) closeOverlay(); });

      // keyboard: Escape to close, Tab to trap focus inside overlay when open
      document.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape' && overlay.classList.contains('open')) { closeOverlay(); }
        if(e.key === 'Tab' && overlay.classList.contains('open')){
          const focusables = overlay.querySelectorAll('a[href], button:not([disabled]), [tabindex]:not([tabindex="-1"])');
          if(focusables.length === 0) return;
          const first = focusables[0];
          const last = focusables[focusables.length - 1];
          if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
          else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
        }
      });
    })();

    /*************************************************************************
     * PROFIL: hover zoom sudah di CSS; klik => flip (toggle class)
     *************************************************************************/
    (function(){
      const card = document.getElementById('profileCard');
      function toggleFlip(){
        const flipped = card.classList.toggle('is-flipped');
        card.setAttribute('aria-pressed', flipped ? 'true' : 'false');
      }
      card.addEventListener('click', toggleFlip);
      // akses keyboard: Enter / Space untuk flip
      card.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleFlip(); }
      });
    })();

    /*************************************************************************
     * PROJECTS DATA: dua grup masing-masing 12 proyek (sample data).
     * Untuk tiap item: id, title, desc, category, img
     *************************************************************************/
    const sampleProjects = Array.from({length:12}).map((_,i)=>({
      id: 'p'+(i+1),
      title: 'Projek PPLG '+(i+1),
      desc: 'Projek terkait PPLG: aplikasi manajemen, CRUD, dan antarmuka pengguna. (Singkat)',
      category: ['web','mobile','game','ai'][i%4],
      img: 'https://placehold.co/600x400?text=Projek+'+(i+1)
    }));
    const sampleCurrent = Array.from({length:12}).map((_,i)=>({
      id: 'c'+(i+1),
      title: 'Projek Sedang '+(i+1),
      desc: 'Proyek sedang berjalan: fitur login, integrasi API, dan deployment.',
      category: ['web','mobile','game','web'][i%4],
      img: 'https://placehold.co/600x400?text=Sedang+'+(i+1)
    }));

    /*************************************************************************
     * RENDERING GRID dengan filter, pagination, load more, dan animasi masuk
     *************************************************************************/
    function setupGrid(data, containerId, controlsPrefix){
      const container = document.getElementById(containerId);
      let filter = 'all';
      let page = 0;
      const pageSize = 6; // pagination sederhana
      let visibleData = data.slice();

      // IntersectionObserver untuk animasi masuk
      const obs = new IntersectionObserver((entries)=>{
        entries.forEach(ent=>{
          if(ent.isIntersecting){
            ent.target.classList.add('visible');
            obs.unobserve(ent.target);
          }
        });
      }, {threshold:0.1});

      function render(){
        container.innerHTML = '';
        const start = page * pageSize;
        const slice = visibleData.slice(start, start + pageSize);
        slice.forEach(item=>{
         const card = el('article','card');
         card.setAttribute('data-id', item.id);
         card.innerHTML = `
           <img src="${item.img}" alt="${esc(item.title)}">
           <div class="title">${esc(item.title)}</div>
           <div class="desc">${esc(item.desc)}</div>
         `;
         container.appendChild(card);
         obs.observe(card);
        });
      }

      // filter handler (global untuk controls di section)
      function applyFilter(f){
        filter = f || 'all';
        visibleData = data.filter(d => filter === 'all' ? true : d.category === filter);
        page = 0;
        render();
      }

      // pagination
      function nextPage(){ if((page+1)*pageSize < visibleData.length){ page++; render(); } }
      function prevPage(){ if(page>0){ page--; render(); } }

      // load more (append next page)
      function loadMore(){
        if((page+1)*pageSize < visibleData.length) page++, render();
      }

      // wire prev/next/load with IDs based on controlsPrefix
      const prevBtn = document.getElementById('prev' + controlsPrefix);
      const nextBtn = document.getElementById('next' + controlsPrefix);
      const loadBtn = document.getElementById('loadMore' + controlsPrefix);
      if(prevBtn) prevBtn.addEventListener('click', prevPage);
      if(nextBtn) nextBtn.addEventListener('click', nextPage);
      if(loadBtn) loadBtn.addEventListener('click', loadMore);

      // wire filter buttons in the section (scoped)
      document.querySelectorAll('#'+containerId).forEach(()=>{}); // noop (keamanan)
      // attach filter buttons (scan around parent section)
      const sec = container.closest('.section');
      if(sec){
        sec.querySelectorAll('.filter-btn').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            sec.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
            applyFilter(btn.getAttribute('data-filter'));
          });
        });
      }

      // initial render
      applyFilter('all');
    }

    // inisialisasi kedua grid
    document.addEventListener('DOMContentLoaded', ()=>{
      setupGrid(sampleProjects, 'projectsGrid', 'Projects');
      setupGrid(sampleCurrent, 'currentGrid', 'Current');
    });

    /*************************************************************************
     * COMMENTS: simpan di localStorage, hapus -> pindah ke deleted, restore
     *************************************************************************/
    const STORAGE_KEY = 'mm_comments_v1';
    const STORAGE_TRASH = 'mm_comments_deleted_v1';

    function loadComments(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }catch(e){ return []; } }
    function saveComments(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }
    function loadDeleted(){ try{ return JSON.parse(localStorage.getItem(STORAGE_TRASH)) || []; }catch(e){ return []; } }
    function saveDeleted(arr){ localStorage.setItem(STORAGE_TRASH, JSON.stringify(arr)); }

    (function(){
      const form = document.getElementById('commentForm');
      const list = document.getElementById('commentsList');
      const modal = document.getElementById('commentsModal');
      const openModalBtn = document.getElementById('openCommentsModal');
      const openCommentsBtn = document.getElementById('openCommentsBtn');
      const closeModalBtn = document.getElementById('closeCommentsModal');
      const showDeletedBtn = document.getElementById('showDeletedBtn');

      function renderList(){
        const comments = loadComments().slice().reverse();
        list.innerHTML = '';
        if(comments.length === 0){
          list.innerHTML = '<div style="color:var(--muted)">Belum ada komentar.</div>';
          return;
        }
        comments.forEach((c,idx)=>{
          const item = el('div','comment-item');
          const left = el('div');
          left.innerHTML = `<div class="comment-meta">${esc(c.name || 'Anonymous')}</div><div class="comment-date">${esc(c.date)}</div><div style="color:var(--muted);margin-top:6px">${esc(c.message)}</div>`;
          const right = el('div');
          const del = el('button','comment-delete');
          del.textContent = 'Hapus';
          del.addEventListener('click', ()=>{
            // animasi lalu pindah ke deleted storage
            item.style.transition = 'opacity 300ms, transform 300ms';
            item.style.opacity = '0'; item.style.transform = 'translateY(10px)';
            setTimeout(()=>{
              const arr = loadComments();
              const realIdx = arr.findIndex(x=> x.id === c.id);
              if(realIdx > -1){
                const [removed] = arr.splice(realIdx,1);
                saveComments(arr);
                const trash = loadDeleted();
                trash.push(Object.assign({}, removed, {deletedAt: new Date().toISOString()}));
                saveDeleted(trash);
                renderList(); renderModal(); // update UI
              }
            },300);
          });
          right.appendChild(del);
          item.appendChild(left); item.appendChild(right);
          list.appendChild(item);
        });
      }

      // Form submit
      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        const name = document.getElementById('cname').value.trim() || 'Anonymous';
        const msg = document.getElementById('cmsg').value.trim();
        if(!msg) return;
        const arr = loadComments();
        arr.push({id:'cm_'+Date.now(), name, message: msg, date: new Date().toLocaleString()});
        saveComments(arr);
        form.reset();
        renderList();
      });

      // Modal open/close
      openModalBtn.addEventListener('click', ()=>{ modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); renderModal(); });
      openCommentsBtn.addEventListener('click', ()=>{ document.getElementById('comments').scrollIntoView({behavior:'smooth'}); });
      closeModalBtn.addEventListener('click', ()=>{ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); });
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') modal.classList.remove('open'); });

      // Show deleted toggler (inline)
      showDeletedBtn.addEventListener('click', ()=>{ openDeletedViewer(); });

      // Modal content render
      function renderModal(filter='all'){
        const area = document.getElementById('modalCommentsArea');
        area.innerHTML = '';
        if(filter === 'deleted'){
          const del = loadDeleted().slice().reverse();
          if(del.length===0){ area.innerHTML = '<div style="color:var(--muted)">Tidak ada komentar terhapus.</div>'; return; }
          del.forEach(c=>{
            const row = el('div','comment-item');
            row.innerHTML = `<div><div class="comment-meta">${esc(c.name)}</div><div class="comment-date">Dihapus: ${esc(new Date(c.deletedAt).toLocaleString())}</div><div style="color:var(--muted);margin-top:6px">${esc(c.message)}</div></div>`;
            const actions = el('div');
            const restore = el('button','filter-btn'); restore.textContent = 'Restore';
            const perm = el('button','comment-delete'); perm.textContent = 'Hapus Permanen';
            restore.addEventListener('click', ()=>{
              const trash = loadDeleted();
              const idx = trash.findIndex(x=>x.id===c.id);
              if(idx>-1){ const [restored] = trash.splice(idx,1); saveDeleted(trash);
                const arr = loadComments(); arr.push({id:restored.id, name:restored.name, message:restored.message, date: new Date().toLocaleString()}); saveComments(arr);
                renderModal('deleted'); renderList();
              }
            });
            perm.addEventListener('click', ()=>{
              const trash = loadDeleted();
              const idx = trash.findIndex(x=>x.id===c.id);
              if(idx>-1){ trash.splice(idx,1); saveDeleted(trash); renderModal('deleted'); }
            });
            actions.appendChild(restore); actions.appendChild(perm);
            row.appendChild(actions);
            area.appendChild(row);
          });
          return;
        }

        // active comments
        const comments = loadComments().slice().reverse();
        if(comments.length===0){ area.innerHTML = '<div style="color:var(--muted)">Belum ada komentar.</div>'; return; }
        comments.forEach(c=>{
          const box = el('div','comment-item');
          box.innerHTML = `<div><div class="comment-meta">${esc(c.name)}</div><div class="comment-date">${esc(c.date)}</div><div style="color:var(--muted);margin-top:6px">${esc(c.message)}</div></div>`;
          const btns = el('div');
          const del = el('button','comment-delete'); del.textContent = 'Hapus';
          del.addEventListener('click', ()=>{
            // perpindahan ke deleted
            const arr = loadComments(); const idx = arr.findIndex(x=>x.id===c.id);
            if(idx>-1){ const [removed] = arr.splice(idx,1); saveComments(arr);
              const trash = loadDeleted(); removed.deletedAt = new Date().toISOString(); trash.push(removed); saveDeleted(trash);
              renderModal(); renderList();
            }
          });
          btns.appendChild(del); box.appendChild(btns);
          area.appendChild(box);
        });
      }

      function openDeletedViewer(){
        // buka modal dan render deleted
        document.getElementById('commentsModal').classList.add('open');
        renderModal('deleted');
      }

      // initial render on page
      renderList();
    })();

    /*************************************************************************
     * ACCESSIBILITY: keyboard shortcut untuk buka overlay Sites (key 'o')
     *************************************************************************/
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'o' && (document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA')){
        const overlay = document.getElementById('overlaySites');
        overlay.classList.toggle('open');
      }
    });

    /*************************************************************************
     * OPTIONAL: smooth reveal for elements already present (aria-friendly)
     *************************************************************************/
    (function(){
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
          if(e.isIntersecting) e.target.classList.add('visible');
        });
      }, {threshold:0.12});
      document.querySelectorAll('.card, .intro, .section').forEach(elm => io.observe(elm));
    })();

    /*************************************************************************
     * SMALL: prevent focus styles lost on mouse click for usability
     *************************************************************************/
    (function(){
      let usingMouse = false;
      document.addEventListener('mousedown', ()=> usingMouse=true);
      document.addEventListener('keydown', ()=> usingMouse=false);
      document.addEventListener('focusin', (e)=>{
        if(usingMouse) e.target.style.outline = 'none';
        else e.target.style.outline = '';
      });
    })();

    /*************************************************************************
     * Akhir: isi placeholder untuk projek langsung dimasukkan ke grid pada DOMContentLoaded
     *************************************************************************/
    document.addEventListener('DOMContentLoaded', ()=>{
      // jika grids belum diisi (setupGrid akan memanggil render pada load), nothing to do
    });

    // MOBILE MENU LOGIC
    document.addEventListener('DOMContentLoaded', ()=>{
     const btn = document.getElementById('menuMobileBtn');
     const menu = document.getElementById('menuMobile');
     btn.addEventListener('click', ()=>{
       menu.classList.toggle('open');
     });
     // Close menu on click outside
     document.addEventListener('click', (e)=>{
       if(menu.classList.contains('open') && !menu.contains(e.target) && e.target !== btn){
         menu.classList.remove('open');
       }
     });
     // Sync "My Other Website" button in mobile menu: close mobile menu when tapped
     const mobileSitesBtn = document.getElementById('openSitesBtnMobile');
     if(mobileSitesBtn){
       mobileSitesBtn.addEventListener('click', ()=>{
         // overlay open/aria handled by the overlay script; here we just close the mobile menu
         menu.classList.remove('open');
       });
     }
     // Sync Comments button in mobile menu
     document.getElementById('openCommentsBtnMobile').addEventListener('click', ()=>{
       document.getElementById('comments').scrollIntoView({behavior:'smooth'});
       menu.classList.remove('open');
     });
   });
  </script>
</body>
</html>